(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{143:function(e,t,a){},181:function(e,t,a){e.exports=a(413)},186:function(e,t,a){},188:function(e,t,a){},194:function(e,t){},196:function(e,t){},308:function(e,t){},314:function(e,t,a){},413:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(27),o=a.n(s),i=(a(186),a(10)),c=a(17),l=a(21),u=a(20),m=a(22),d=a(23),h=(a(188),a(190),function(){function e(){Object(i.a)(this,e)}return Object(c.a)(e,[{key:"login",value:function(e){return Re.post("http://127.0.0.1:3030/api/login",e)}}]),e}()),g=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={uname:"",pass:""},a.auth=new h,a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){}},{key:"loginClick",value:function(e){var t=this,a={email:this.state.uname,password:this.state.pass};this.auth.login(a).then(function(e){e.data.success?(console.log(e.data.docs),localStorage.setItem("loggedUser",JSON.stringify(e.data.docs)),t.props.login(e.data.docs),console.log("User logged in")):console.log("Credentials error")})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"Login"},r.a.createElement("header",{className:"Login-header"},"Email:",r.a.createElement("input",{type:"email",required:!0,onChange:function(t){return e.setState({uname:t.target.value})}}),r.a.createElement("br",null),"Password:",r.a.createElement("input",{type:"password",required:!0,onChange:function(t){return e.setState({pass:t.target.value})}}),r.a.createElement("br",null),r.a.createElement("button",{onClick:function(t){return e.loginClick(t)}},"Submit")))}}]),t}(n.Component),p=a(424),f=a(427),v=a(428),y=a(429),b=a(426),E=a(30),C=a.n(E),O=a(91),k=a.n(O),S=a(90),j=a.n(S),w=a(172),N=a.n(w),P=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleclick=function(e,t){a.props.selectChat(t.id),a.setState({renderedChats:a.renderChats(t.id)})},a.state={chats:null,renderedChats:[],selectedChat:a.props.selectedChat},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){var e=this;Ie.getChats().then(function(t){e.setState({chats:t.data.docs}),e.props.subscribeRooms(t.data.docs)}).then(function(t){e.setState({renderedChats:e.renderChats()})})}},{key:"renderChats",value:function(e){var t,a=this;return t=this.state.chats.map(function(t){return console.log(a.props.selectedChat),r.a.createElement("div",{key:t.id,chat:t.id,className:e==t.id?"selected":"not-selected",onClick:function(e){return a.handleclick(e,t)}},r.a.createElement(j.a,{button:!0},r.a.createElement(N.a,{primary:t.name})))}),console.log(t),t}},{key:"render",value:function(){return r.a.createElement("div",{className:"chatList"},r.a.createElement(k.a,{component:"nav"},this.state.renderedChats))}}]),t}(n.Component),M=a(53),x=a.n(M),R=(a(143),function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).sendClick=function(e){Ue.sendMessage(a.state.newMessage,a.props.selectedChat).then(function(e){a.setState({newMessage:""})}).then(function(e){Be.emit("message",{room:a.props.selectedChat,sender:a.props.user})})},a.typing=function(e){a.setState({newMessage:e.target.value}),Be.emit("typing",{room:a.props.selectedChat,sender:a.props.user})},a.keyDown=function(e){13==e.keyCode&&a.sendClick(e)},a.state={newMessage:"",chatHistory:a.props.chatHistory,newmessages:[],newmessagetrigger:!0,isTyping:!1},a.renderHistory=a.renderHistory.bind(Object(d.a)(Object(d.a)(a))),Be.on("typing",function(e){e.sender.id!==a.props.user.id&&(a.setState({isTyping:!0}),setTimeout(function(){a.setState({isTyping:!1})},8e3))}),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillMount",value:function(){}},{key:"enterRoom",value:function(){}},{key:"renderHistory",value:function(){var e=this,t=[];return this.props.chatHistory&&(t=this.props.chatHistory.slice().map(function(t){return r.a.createElement("div",{className:t.sender?t.sender.id==e.props.user.id?"myMessage":"theirMessage":"",key:t._id},t.sender?t.sender.name:"anonymous",":",t.text)})),t.length?t:r.a.createElement("div",{className:"empty"},"This chat is empty")}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"chatWindow wrap"},r.a.createElement("ul",{className:"messageHistory"},"room is ",this.props.selectedChat,r.a.createElement("div",null,this.renderHistory())),r.a.createElement("div",{className:"userTyping"},this.state.isTyping?"typing":""),r.a.createElement("div",{className:"inputBox"},r.a.createElement("input",{type:"text",value:this.state.newMessage,onChange:function(t){return e.typing(t)},onKeyDown:this.keyDown}),r.a.createElement("button",{type:"submit",onClick:function(t){return e.sendClick(t)}},"Send!")))}}]),t}(n.Component)),I=a(67),U=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={user:a.props.user,selectedChat:null,chatHistory:null,newmessages:null,newmessagetrigger:!0},a.selectChat=a.selectChat.bind(Object(d.a)(Object(d.a)(a))),a.subscribeRooms=a.subscribeRooms.bind(Object(d.a)(Object(d.a)(a))),a.getMessages=a.getMessages.bind(Object(d.a)(Object(d.a)(a))),console.log(Be),Be.disconnected&&Be.connect(),console.log(Be.disconnected),Be.on("message",function(e){a.state.selectedChat==e.room&&a.getMessages(e.room)}),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.chatSelected&&this.selectChat(this.props.chatSelected)}},{key:"selectChat",value:function(e){this.setState({selectedChat:e}),this.getMessages(e)}},{key:"getMessages",value:function(e){var t=this;Ue.retrieveMessages(e).then(function(e){t.setState({chatHistory:e.data.docs})})}},{key:"subscribeRooms",value:function(e){var t=this;I.pluck(e,"id").forEach(function(e){Be.emit("goOnline",{sender:t.state.user.id,room:e})}),this.setState({rooms:e})}},{key:"render",value:function(){var e=this.state.selectedChat?r.a.createElement(C.a,{item:!0,xs:12,sm:9,className:"wrap"},r.a.createElement(R,{selectedChat:this.state.selectedChat,chatHistory:this.state.chatHistory,className:"chatList",user:this.props.user,newmessages:this.state.newmessages})):this.state.rooms&&this.state.rooms.length?r.a.createElement("div",{className:"noInfo"},"Select chat from the left "):r.a.createElement("div",{className:"noInfo"}," You don't have any chats. Find a friend!");return r.a.createElement("div",{className:"homeWrapper"},r.a.createElement(C.a,{container:!0,spacing:0,className:"wrap"},r.a.createElement(C.a,{item:!0,xs:12,sm:3,className:"chatList"},r.a.createElement(P,{selectChat:this.selectChat,selectedChat:this.state.selectedChat,subscribeRooms:this.subscribeRooms})),e))}}]),t}(n.Component),B=(a(314),a(425)),H=a(421),L=a(422),W=a(423),T=a(178),D=a(67),J=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).search=function(e){Ie.findUsers(e.target.value).then(function(t){0!==t.data.docs.length&&e?a.setState({searchResults:r.a.createElement("div",null,a.generate(t.data.docs))}):a.setState({searchResults:r.a.createElement("div",{className:"notFound"},"No Users Found :(")})})},a.state={searchResults:null},a.results=null,a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"startConversation",value:function(e){Ue.startChat(Ie.user,e).then(function(e){e.data.success&&Be.emit("newChat",{name:e.data.docs.name,sender:Ie.user})})}},{key:"generate",value:function(e){var t=this;return D.map(e,function(e,a){return r.a.createElement(H.a,{key:a},r.a.createElement(L.a,null,e.name),r.a.createElement(L.a,null,r.a.createElement(B.a,{color:"secondary",onClick:function(){return t.startConversation(e.id)}},r.a.createElement(T.a,null))))})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"searchWrap"},r.a.createElement("input",{type:"text",onChange:function(t){""!==t.target.value&&e.search(t)}}),r.a.createElement("div",{className:"searchResults"},r.a.createElement(W.a,null,this.state.searchResults)))}}]),t}(n.Component),q=function e(){var t=this;Object(i.a)(this,e),this.user=null,this.setUser=function(e){t.user=e},this.getAllUsers=function(){return Re.get("http://127.0.0.1:3030/api/users")},this.getChats=function(){return Re.get("http://127.0.0.1:3030/api/dialogs/")},this.findUsers=function(e){return Re.post("http://127.0.0.1:3030/api/users/find",{pattern:e})},null===this.user&&localStorage.getItem("loggedUser")&&(this.user=JSON.parse(localStorage.getItem("loggedUser")),Re.defaults.headers.common.loggeduser=localStorage.getItem("loggedUser")),console.log("User in user service",this.user)},F=function e(){var t=this;Object(i.a)(this,e),this.openConversation=null,this.selectConversation=function(e){t.openConversation=e},this.sendMessage=function(e,t){var a={message:e,dialog:t};return Re.post("http://127.0.0.1:3030/api/dialogs",a)},this.getChats=function(){return Re.get("http://127.0.0.1:3030/api/dialogs/")},this.retrieveMessages=function(e){return Re.get("http://127.0.0.1:3030/api/dialogs/"+e)},this.startChat=function(e,t){var a={loggeduser:e,startWithId:t};return Re.post("http://127.0.0.1:3030/api/dialogs/new",a)},this.getlog=function(){return Re.get("http://127.0.0.1:3030/api/eventlog")},this.gethistory=function(){return Re.get("http://127.0.0.1:3030/api/history")},this.getroomhistory=function(e){return Re.post("http://127.0.0.1:3030/api/roomhistory",{room:e})},this.getallrooms=function(){return Re.get("http://127.0.0.1:3030/api/rooms")}},A=a(45),_=a.n(A),K=a(175),V=a(5),X=a.n(V),Y=a(72),$=a(94),z=a.n($),G=a(95),Q=a.n(G),Z=a(18),ee=a.n(Z),te=a(92),ae=a.n(te),ne=a(96),re=a.n(ne),se=a(38),oe=a.n(se),ie=a(176),ce=a.n(ie),le=a(93),ue=a.n(le),me=a(54),de=a.n(me),he=a(71),ge=a.n(he),pe=a(70),fe=a.n(pe),ve=a(97),ye=a.n(ve),be=a(177),Ee=a.n(be),Ce=a(44),Oe=a(67);function ke(e,t,a){return t[a]<e[a]?-1:t[a]>e[a]?1:0}function Se(e){var t=e.map(function(e){return{id:e,numeric:!1,disablePadding:!1,label:e.toUpperCase()}});return t.unshift({id:"id",numeric:!1,disablePadding:!0,label:"ID"}),t}var je=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).createSortHandler=function(e){return function(t){a.props.onRequestSort(t,e)}},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.order,n=t.orderBy,s=(t.numSelected,t.rowCount,t.rows);return r.a.createElement(ae.a,null,r.a.createElement(oe.a,null,s.map(function(t){return r.a.createElement(ee.a,{key:t.id,align:t.numeric?"right":"left",padding:t.disablePadding?"none":"default",sortDirection:n===t.id&&a},r.a.createElement(ye.a,{title:"Sort",placement:t.numeric?"bottom-end":"bottom-start",enterDelay:300},r.a.createElement(ce.a,{active:n===t.id,direction:a,onClick:e.createSortHandler(t.id)},t.label)))},this)))}}]),t}(r.a.Component),we=function(e){var t=e.numSelected,a=e.classes;return r.a.createElement(ue.a,{className:X()(a.root,Object(K.a)({},a.highlight,t>0))},r.a.createElement("div",{className:a.title},t>0?r.a.createElement(de.a,{color:"inherit",variant:"subtitle1"},t," selected"):r.a.createElement(de.a,{variant:"h6",id:"tableTitle"},"Nutrition")),r.a.createElement("div",{className:a.spacer}),r.a.createElement("div",{className:a.actions},r.a.createElement(ye.a,{title:"Filter list"},r.a.createElement(fe.a,{"aria-label":"Filter list"},r.a.createElement(Ee.a,null)))))};we=Object(Y.withStyles)(function(e){return{root:{paddingRight:e.spacing.unit},highlight:"light"===e.palette.type?{color:e.palette.secondary.main,backgroundColor:Object(Ce.lighten)(e.palette.secondary.light,.85)}:{color:e.palette.text.primary,backgroundColor:e.palette.secondary.dark},spacer:{flex:"1 1 100%"},actions:{color:e.palette.text.secondary},title:{flex:"0 0 auto"}}})(we);var Ne=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={order:"asc",orderBy:"calories",selected:[],page:0,rowsPerPage:5,data:[]},a.handleRequestSort=function(e,t){var n=t,r="desc";a.state.orderBy===t&&"desc"===a.state.order&&(r="asc"),a.setState({order:r,orderBy:n})},a.handleChangePage=function(e,t){a.setState({page:t})},a.handleChangeRowsPerPage=function(e){a.setState({rowsPerPage:e.target.value})},a.isSelected=function(e){return-1!==a.state.selected.indexOf(e)},a.renderRow=function(e,t,a){switch(e){case"log":return r.a.createElement(oe.a,{hover:!0,role:"checkbox","aria-checked":a,tabIndex:-1,key:t.id,selected:a},r.a.createElement(ee.a,{component:"th",scope:"row",padding:"none"},t.id),r.a.createElement(ee.a,{align:"right"},t.time),r.a.createElement(ee.a,{align:"right"},t.type),r.a.createElement(ee.a,{align:"right"},t.message),r.a.createElement(ee.a,{align:"right"},t.sender));case"history":return r.a.createElement(oe.a,{hover:!0,role:"checkbox","aria-checked":a,tabIndex:-1,key:t.id,selected:a},r.a.createElement(ee.a,{component:"th",scope:"row",padding:"none"},t._id),r.a.createElement(ee.a,{align:"right"},t.text),r.a.createElement(ee.a,{align:"right"},t.sender),r.a.createElement(ee.a,{align:"right"},t.time));case"roomresult":return r.a.createElement(oe.a,{hover:!0,role:"checkbox","aria-checked":a,tabIndex:-1,key:t.id,selected:a},r.a.createElement(ee.a,{component:"th",scope:"row",padding:"none"},t.id),r.a.createElement(ee.a,{align:"right"},t.name),r.a.createElement(ee.a,{align:"right"},t.lastMessage),r.a.createElement(ee.a,{align:"right"},t["Date of Creation"]),r.a.createElement(ee.a,{align:"right"},t.Participants))}},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=this.props.classes,a=this.state,n=a.order,s=a.orderBy,o=a.selected,i=a.rowsPerPage,c=a.page;console.log(this.props.data);var l=this.props.data?this.props.data.data:[{}],u=i-Math.min(i,l.length-c*i);return r.a.createElement(ge.a,{className:t.root},r.a.createElement("div",{className:t.tableWrapper},r.a.createElement(z.a,{className:t.table,"aria-labelledby":"tableTitle"},r.a.createElement(je,{numSelected:o.length,order:n,orderBy:s,onRequestSort:this.handleRequestSort,rowCount:l.length,rows:Se(Oe.without(Object.keys(l[0]),"__v","_id","id"))}),r.a.createElement(Q.a,null,function(e,t){var a=e.map(function(e,t){return[e,t]});return a.sort(function(e,a){var n=t(e[0],a[0]);return 0!==n?n:e[1].id-a[1].id}),a.map(function(e){return e[0]})}(l,function(e,t){return"desc"===e?function(e,a){return ke(e,a,t)}:function(e,a){return-ke(e,a,t)}}(n,s)).slice(c*i,c*i+i).map(function(t){var a=e.isSelected(t.id);return e.renderRow(e.props.name,t,a)}),u>0&&r.a.createElement(oe.a,{style:{height:49*u}},r.a.createElement(ee.a,{colSpan:6}))))),r.a.createElement(re.a,{rowsPerPageOptions:[5,10,25],component:"div",count:l.length,rowsPerPage:i,page:c,backIconButtonProps:{"aria-label":"Previous Page"},nextIconButtonProps:{"aria-label":"Next Page"},onChangePage:this.handleChangePage,onChangeRowsPerPage:this.handleChangeRowsPerPage}))}}]),t}(r.a.Component),Pe=Object(Y.withStyles)(function(e){return{root:{width:"100%",marginTop:3*e.spacing.unit},table:{minWidth:1020},tableWrapper:{overflowX:"auto"}}})(Ne),Me=new F,xe=(a(67),function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={logresult:[],isloading:!0},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;Me.getlog().then(function(t){t&&e.setState({logresult:t.data})}).then(function(t){Me.gethistory().then(function(t){t&&e.setState({historyresult:t.data})})}).then(function(t){Me.getallrooms().then(function(t){t&&e.setState({roomsresult:t.data},function(){e.setState({isloading:!1})})})})}},{key:"tables",value:function(){return r.a.createElement("div",{className:"Admin"},r.a.createElement("h2",null,"Log"),r.a.createElement(Pe,{data:this.state.logresult,name:"log"}),r.a.createElement("h2",null,"Chat History"),r.a.createElement(Pe,{data:this.state.historyresult,name:"history"}),r.a.createElement("h2",null,"Rooms"),r.a.createElement(Pe,{data:this.state.roomsresult,name:"roomresult"}))}},{key:"render",value:function(){return console.log(this.state.logresult),console.log(this.state.historyresult),console.log(this.state.roomsresult),this.state.isloading?"Still loading..":this.tables()}}]),t}(n.Component)),Re=a(390),Ie=new q,Ue=new F,Be=x()("http://localhost:8000"),He=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).homeTemp=function(e,t){return e?r.a.createElement(U,{user:e,chatSelected:t}):a.loginEl()},a.api=function(e){return e?r.a.createElement(xe,null):a.loginEl()},a.getroomhistory=function(){a.state.roomapi?Ue.getroomhistory(a.state.roomapi).then(function(e){console.log(e.data.data),e.data.success?a.setState({apiresult:JSON.stringify(e.data.data)}):a.setState({apiresult:"room not found"})}):a.setState({apiresult:"room name is empty"})},a.getallhistory=function(){Ue.gethistory().then(function(e){a.setState({apiresult:JSON.stringify(e.data)})})},a.getlog=function(){Ue.getlog().then(function(e){a.setState({apiresult:JSON.stringify(e.data)})})},a.search=function(e){return e?r.a.createElement(J,{user:e}):a.loginEl()},a.handleLogoutClick=function(){localStorage.setItem("logout-event","logout"+Math.random()),Be.close(),a.logout()},a.logout=function(){Ie.user=null,localStorage.removeItem("loggedUser"),a.setState({loggeduser:null}),Re.defaults.headers.common.loggeduser=null},a.login=function(e){Re.defaults.headers.common.loggeduser=JSON.stringify(e),Ie.setUser(e),a.setState({loggeduser:e},function(){Be.connect()})},a.state={loggeduser:JSON.parse(localStorage.getItem("loggedUser")),apiresult:null,roomapi:null},a.handleLogoutClick=a.handleLogoutClick.bind(Object(d.a)(Object(d.a)(a))),a.logout=a.logout.bind(Object(d.a)(Object(d.a)(a))),window.addEventListener("storage",function(e){"logout-event"==e.key?a.logout():"loggedUser"==e.key&&(Re.defaults.headers.common.loggeduser=localStorage.getItem("loggedUser"),Ie.setUser(JSON.parse(localStorage.getItem("loggedUser"))),a.setState({loggeduser:JSON.parse(localStorage.getItem("loggedUser"))},function(){Be.connect()}))}),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){localStorage.getItem("loggedUser")&&Be.connect()}},{key:"loginEl",value:function(){var e=this;return r.a.createElement(g,{login:function(t){return e.login(t)}})}},{key:"render",value:function(){var e,t=this;return e=this.state.loggeduser?r.a.createElement(p.a,{to:"/login",className:"buttonLink"}," ",r.a.createElement(_.a,{variant:"contained",color:"primary",className:"menuBtn",onClick:this.handleLogoutClick},"Logout")):r.a.createElement(p.a,{to:"/login",className:"buttonLink"},r.a.createElement(_.a,{variant:"contained",color:"primary",className:"menuBtn"},"Login")," "),r.a.createElement("div",{className:"App"},r.a.createElement(f.a,null,r.a.createElement("div",{className:"router"},r.a.createElement("div",{className:"menuVisual"},r.a.createElement(C.a,{container:!0,spacing:0,className:"menuContainer"},r.a.createElement(C.a,{item:!0,xs:12,sm:4,className:"menuBtn"},r.a.createElement(p.a,{to:"/"},r.a.createElement(_.a,{variant:"contained",color:"primary"},"Home")," ")),r.a.createElement(C.a,{item:!0,xs:12,sm:4,className:"menuBtn"},r.a.createElement(p.a,{to:"/search"},r.a.createElement(_.a,{variant:"contained",color:"primary"},"Find")," ")),r.a.createElement(C.a,{item:!0,xs:12,sm:4,className:"menuBtn"},r.a.createElement(p.a,{to:"/api"},r.a.createElement(_.a,{variant:"contained",color:"primary"},"API")," ")),r.a.createElement(C.a,{item:!0,xs:12,sm:4,className:"menuBtn"},e," "))),r.a.createElement(v.a,{className:"routeWindow"},r.a.createElement(y.a,{exact:!0,path:"/",render:function(){return t.homeTemp(t.state.loggeduser)}}),r.a.createElement(y.a,{path:"/login",render:function(){return t.homeTemp(t.state.loggeduser)}}),r.a.createElement(y.a,{path:"/search",render:function(){return t.search(t.state.loggeduser)}}),r.a.createElement(y.a,{path:"/api",render:function(){return t.api(t.state.loggeduser)}}),r.a.createElement(b.a,{from:"/*",to:"/"})))))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(411);o.a.render(r.a.createElement(He,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[181,2,1]]]);
//# sourceMappingURL=main.115e41a7.chunk.js.map